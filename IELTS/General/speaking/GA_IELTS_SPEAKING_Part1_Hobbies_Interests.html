<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS General Speaking Part 1 - Hobbies & Interests | Gammapace Foundation</title>

    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Century Gothic', sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.3) 0%, rgba(139, 69, 19, 0.2) 50%, rgba(255, 215, 0, 0.1) 100%);
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(139, 69, 19, 0.05) 0%, transparent 50%);
            z-index: -1;
            pointer-events: none;
        }

        /* Header spacing */
        .header-spacer {
            height: 20px;
            width: 100%;
        }

        /* Guruvammal Logo as Back Button - Right Side */
        .gk-logo-container {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 1002;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .gk-logo-container:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
        }

        /* Master Guruvammal Logo for template back button */
        .master-guruvammal-logo {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            box-sizing: border-box;
            font-family: 'Century Gothic', sans-serif;
            font-size: 26px;
            font-weight: 900;
            letter-spacing: -1px;
            line-height: 1;
            color: #5d3a0a;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(139, 69, 19, 0.25) 50%, rgba(205, 133, 63, 0.2) 100%);
            backdrop-filter: blur(10px);
            border-radius: 6px;
            padding: 10px;
            box-shadow: 0 8px 25px rgba(139, 69, 19, 0.3), 0 0 40px rgba(212, 175, 55, 0.2);
            z-index: 10000;
            transition: all 0.3s ease;
        }

        .master-guruvammal-logo .musical-corner {
            position: absolute;
            top: 3px;
            right: 4px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: transparent;
            border: 1px solid #5d3a0a;
            color: #5d3a0a;
            font-family: 'Century Gothic', sans-serif;
            font-size: 7px;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3);
            box-shadow: none;
        }

        .master-guruvammal-logo:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(139, 69, 19, 0.4), 0 0 50px rgba(212, 175, 55, 0.3);
        }

        .back-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #8b4513;
            font-family: 'Century Gothic', sans-serif;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .gk-logo-container:hover .back-label {
            color: #5d3a0a;
            transform: translateY(-1px);
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            margin-left: 380px;
            padding: 0 1rem;
            transition: margin-left 0.3s ease;
        }

        .container.menu-collapsed {
            margin-left: 20px;
        }

        /* Main Content */
        .main-content {
            min-height: 100vh;
            padding: 2rem 0;
        }

        /* Slide-out Menu Button */
        .menu-toggle {
            position: fixed;
            top: 30px;
            left: 360px;
            background: linear-gradient(135deg, #8b4513, #a0522d);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 0.8rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
            z-index: 1001;
            transition: all 0.3s ease;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .menu-toggle.collapsed {
            left: 20px;
        }

        .menu-toggle:hover {
            background: linear-gradient(135deg, #a0522d, #8b4513);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 69, 19, 0.4);
        }

        .menu-toggle-label {
            position: fixed;
            top: 85px;
            left: 382px;
            background: rgba(139, 69, 19, 0.9);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 2px 8px rgba(139, 69, 19, 0.3);
            z-index: 1001;
            transition: all 0.3s ease;
            min-width: 45px;
            transform: translateX(-50%);
            pointer-events: none;
        }

        .menu-toggle-label.collapsed {
            left: 42px;
        }

        .slide-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100vh;
            background: linear-gradient(180deg, rgba(139, 69, 19, 0.95) 0%, rgba(101, 67, 33, 0.95) 100%);
            backdrop-filter: blur(10px);
            z-index: 999;
            transform: translateX(0);
            transition: transform 0.3s ease;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
        }

        .slide-menu::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 20%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(139, 69, 19, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .slide-menu.collapsed {
            transform: translateX(-280px);
        }

        .menu-header {
            padding: 2rem 1.5rem 1rem;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            position: relative;
            z-index: 1;
        }

        .menu-bookmark-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #d4af37;
            margin-bottom: 0.3rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .menu-subtitle {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .menu-content {
            padding: 1rem 0;
            position: relative;
            z-index: 1;
        }

        .menu-item {
            padding: 0.8rem 1.5rem;
            color: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-weight: 500;
        }

        .menu-item:hover {
            background: rgba(212, 175, 55, 0.2);
            color: white;
            border-left-color: #d4af37;
            padding-left: 2rem;
        }

        .menu-item.active {
            background: rgba(212, 175, 55, 0.3);
            color: #d4af37;
            border-left-color: #d4af37;
            font-weight: 600;
        }

        /* Hero Section */
        .hero-section {
            text-align: center;
            margin-bottom: 3rem;
            padding: 3rem 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .hero-title {
            font-size: 3rem;
            color: #8b4513;
            margin-bottom: 1rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.3);
        }

        .hero-subtitle {
            font-size: 1.5rem;
            color: #d4af37;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .hero-description {
            font-size: 1.1rem;
            color: #666;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.8;
        }

        /* Content Sections */
        .content-section {
            background: rgba(255, 255, 255, 0.9);
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(139, 69, 19, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .section-title {
            font-size: 2rem;
            color: #8b4513;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 600;
        }

        /* Instructions Section */
        .instructions {
            background: rgba(255, 255, 255, 0.9);
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(139, 69, 19, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .instructions h3 {
            color: #8b4513;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .instructions ul {
            list-style: none;
            padding-left: 0;
        }

        .instructions li {
            margin: 0.8rem 0;
            padding-left: 1.5rem;
            position: relative;
            color: #555;
            line-height: 1.6;
        }

        .instructions li:before {
            content: "🎯";
            position: absolute;
            left: 0;
            top: 0;
        }

        .instructions strong {
            color: #8b4513;
        }

        /* Speaking Practice Interface */
        .speaking-interface {
            display: block;
            margin: 2rem 0;
        }

        .recording-panel {
            background: rgba(255, 255, 255, 0.8);
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        /* Recording Status Styles */
        .recording-status {
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }

        .recording-status.idle {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
            border: 1px solid rgba(108, 117, 125, 0.3);
        }

        .recording-status.recording {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.3);
            animation: pulse 2s infinite;
        }

        .recording-status.recorded {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .recording-status.processing {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Timer Display */
        .timer-display {
            font-size: 1.2rem;
            font-weight: 700;
            color: #8b4513;
            margin: 1rem 0;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        /* Audio Visualizer */
        .audio-visualizer {
            background: rgba(139, 69, 19, 0.05);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .visualizer-bars {
            display: flex;
            justify-content: center;
            align-items: end;
            gap: 2px;
            height: 60px;
        }

        .visualizer-bar {
            width: 4px;
            background: linear-gradient(to top, #8b4513, #d4af37);
            border-radius: 2px;
            transition: height 0.1s ease;
        }

        /* Control Buttons */
        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .control-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .record-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .record-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .stop-btn {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .stop-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }

        .play-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }

        .play-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }

        .process-btn {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .process-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .gk-logo-container {
                top: 20px;
                right: 20px;
            }

            .hero-title {
                font-size: 2rem;
            }

            .hero-subtitle {
                font-size: 1.2rem;
            }

            .container {
                padding: 0 0.5rem;

            }

            .content-section, .instructions {
                padding: 1.5rem;
                margin: 1rem 0;
            }

            .slide-menu {
                width: 100%;
                left: -100%;
            }

            .main-content {
                padding: 1rem 0;
            }

            .control-buttons {
                flex-direction: column;
                align-items: center;
            }

            .control-btn {
                min-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="header-spacer"></div>

    <!-- Slide-out Menu Toggle Button -->
    <button class="menu-toggle" onclick="toggleMenu()" id="menuToggle">
        ›
    </button>
    <div class="menu-toggle-label" id="menuToggleLabel">Collapse</div>

    <!-- Slide-out Menu -->
    <div class="slide-menu" id="slideMenu">
        <div class="menu-header">
            <div class="menu-bookmark-title">IELTS Speaking Part 1</div>
            <div class="menu-subtitle">Hobbies & Interests</div>
        </div>
        <div class="menu-content">
            <div class="menu-item" onclick="scrollToSection('instructions')">📋 Instructions</div>
            <div class="menu-item active" onclick="scrollToSection('recording')">🎙️ Recording Studio</div>
            <div class="menu-item" onclick="scrollToSection('analysis')">📊 Analysis Results</div>
            <div class="menu-item" onclick="scrollToSection('guidance')">🎯 Band Score Guidance</div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" id="container">
        <main class="main-content">
            <!-- Gammapace Logo as Back Button -->
            <div class="gk-logo-container" onclick="handleBackButton()">
                <div class="master-guruvammal-logo">
                    Ga<span class="musical-corner">P</span>
                </div>
                <div class="back-label">Back</div>
            </div>

            <!-- Hero Section -->
            <section class="hero-section">
                <h1 class="hero-title">IELTS Speaking Part 1</h1>
                <div class="hero-subtitle">Hobbies & Interests Practice</div>
                <p class="hero-description">
                    Practice answering common Part 1 questions about your hobbies and interests. Record your responses and get automated feedback to improve your speaking skills and achieve your target band score.
                </p>
            </section>

            <!-- Instructions Section -->
            <section class="instructions" id="instructions-section">
                <h3>🎯 How to Practice</h3>
                <ul>
                    <li><strong>Read each question carefully</strong> - Take time to understand what's being asked</li>
                    <li><strong>Think before speaking</strong> - You have a moment to organize your thoughts</li>
                    <li><strong>Speak naturally</strong> - Answer in 20-30 seconds with 2-3 sentences per question</li>
                    <li><strong>Record your response</strong> - Click record, answer the question, then stop</li>
                    <li><strong>Review and improve</strong> - Listen to your original recording and review the analysis feedback</li>
                    <li><strong>Next Question</strong> - After analysis, click "Next Question" to automatically move to the next practice question</li>
                    <li><strong>Retry</strong> - Click "Retry" to practice the same question again with a fresh recording session</li>
                    <li><strong>Practice regularly</strong> - Consistency is key to improving your speaking fluency</li>
                </ul>
            </section>

            <!-- Speaking Practice Interface -->
            <section class="content-section" id="recording-section">
                <h2 class="section-title">🗣️ Speaking Practice Session</h2>
                
                <div class="speaking-interface">
                    <!-- Recording Panel -->
                    <div class="recording-panel">
                        <h3 style="color: #8b4513; margin-bottom: 1rem;">Recording Studio</h3>
                        
                        <!-- Recording Status -->
                        <div class="recording-status idle" id="recordingStatus">
                            Ready to record your response
                        </div>

                        <!-- Timer Display -->
                        <div class="timer-display" id="timerDisplay">00:00</div>

                        <!-- Audio Visualizer -->
                        <div class="audio-visualizer" id="audioVisualizer">
                            <div class="visualizer-bars" id="visualizerBars">
                                <!-- Bars will be generated dynamically -->
                            </div>
                        </div>

                        <!-- Question Selection for Analysis -->
                        <div style="margin: 1rem 0; text-align: center;">
                            <label for="questionSelect" style="color: #8b4513; font-weight: 600; margin-bottom: 0.5rem; display: block;">Which question are you answering?</label>
                            <select id="questionSelect" onchange="updateCurrentQuestion()" style="padding: 0.75rem; border-radius: 5px; border: 1px solid #d4af37; font-size: 1.1rem; width: 100%; max-width: 800px; margin: 0 auto; display: block; line-height: 1.4;">
                                <option value="1">Q1: What do you like to do in your free time?</option>
                                <option value="2">Q2: Do you have any hobbies?</option>
                                <option value="3">Q3: What hobbies are popular in your country?</option>
                                <option value="4">Q4: How did you become interested in your hobby?</option>
                                <option value="5">Q5: Do you think hobbies are important?</option>
                                <option value="6">Q6: How much time do you spend on your hobbies?</option>
                            </select>
                        </div>

                        <!-- Control Buttons -->
                        <div class="control-buttons">
                            <button class="control-btn record-btn" id="recordBtn" onclick="startRecording()">
                                🎤 Start Recording
                            </button>
                            <button class="control-btn stop-btn" id="stopBtn" onclick="stopRecording()" disabled>
                                ⏹️ Stop Recording
                            </button>
                            <button class="control-btn play-btn" id="playBtn" onclick="playOriginal()" disabled>
                                ▶️ Play Original
                            </button>
                            <button class="control-btn process-btn" id="processBtn" onclick="processAudio()" disabled>
                                🔄 Submit for Analysis
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Analysis Results Section -->
                <div id="analysisSection" style="display: none;">
                    <div class="content-section">
                        <h2 class="section-title">📊 Analysis & Improvement</h2>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
                            <!-- What You Said -->
                            <div style="background: rgba(255, 255, 255, 0.8); padding: 1.5rem; border-radius: 10px; border: 1px solid rgba(212, 175, 55, 0.3);">
                                <h3 style="color: #8b4513; margin-bottom: 1rem;">📝 What You Said</h3>
                                <div id="transcriptResult" style="background: rgba(139, 69, 19, 0.05); padding: 1rem; border-radius: 8px; border-left: 4px solid #d4af37; font-style: italic; line-height: 1.6;"></div>
                            </div>

                            <!-- Analysis & Missing Elements -->
                            <div style="background: rgba(255, 255, 255, 0.8); padding: 1.5rem; border-radius: 10px; border: 1px solid rgba(212, 175, 55, 0.3);">
                                <h3 style="color: #8b4513; margin-bottom: 1rem;">🎯 Analysis & What You Missed</h3>
                                <div id="analysisResult" style="line-height: 1.6;"></div>
                            </div>
                        </div>

                        <!-- Improved Response -->
                        <div style="background: rgba(255, 255, 255, 0.8); padding: 1.5rem; border-radius: 10px; border: 1px solid rgba(212, 175, 55, 0.3); margin-bottom: 2rem;">
                            <h3 style="color: #8b4513; margin-bottom: 1rem;">✨ Improved Response Suggestions</h3>
                            <div id="improvedResponse" style="background: rgba(212, 175, 55, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #8b4513; font-weight: 500; line-height: 1.6;"></div>
                        </div>

                        <!-- Band Score Comparison -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div style="background: rgba(255, 0, 0, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #ff6666;">
                                <h4 style="color: #cc0000; margin-bottom: 0.5rem;">Your Current Response</h4>
                                <div id="currentBandScore" style="font-size: 1.1rem; font-weight: 600;"></div>
                            </div>
                            <div style="background: rgba(0, 128, 0, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid #66cc66;">
                                <h4 style="color: #006600; margin-bottom: 0.5rem;">Potential with Improvements</h4>
                                <div id="improvedBandScore" style="font-size: 1.1rem; font-weight: 600;"></div>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div style="display: flex; justify-content: center; gap: 2rem; margin-top: 2rem; padding: 1.5rem;">
                            <button onclick="goToNextQuestion()" style="
                                background: linear-gradient(135deg, #27ae60, #229954);
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 25px;
                                font-size: 1rem;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                min-width: 150px;
                                box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
                            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(39, 174, 96, 0.4)'" onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='0 4px 15px rgba(39, 174, 96, 0.3)'">
                                ➡️ Next Question
                            </button>
                            <button onclick="refreshCurrentQuestion()" style="
                                background: linear-gradient(135deg, #3498db, #2980b9);
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 25px;
                                font-size: 1rem;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                min-width: 150px;
                                box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
                            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(52, 152, 219, 0.4)'" onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='0 4px 15px rgba(52, 152, 219, 0.3)'">
                                🔄 Retry
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Band Score Guidance -->
            <section class="content-section" id="guidance-section">
                <h2 class="section-title">🎯 IELTS Band Score Guidance</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin: 1.5rem 0;">
                    <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid #ffd700; border-radius: 10px; padding: 1rem;">
                        <h4 style="color: #8b4513; margin-bottom: 0.5rem;">🥇 Band 7-9 (Target)</h4>
                        <ul style="color: #666; font-size: 0.9rem; line-height: 1.5; padding-left: 1rem;">
                            <li>Speak fluently with natural rhythm</li>
                            <li>Use varied vocabulary appropriately</li>
                            <li>Demonstrate complex grammar structures</li>
                            <li>Clear pronunciation with correct stress</li>
                            <li>Extend answers with examples and reasons</li>
                        </ul>
                    </div>
                    <div style="background: rgba(212, 175, 55, 0.1); border: 1px solid #d4af37; border-radius: 10px; padding: 1rem;">
                        <h4 style="color: #8b4513; margin-bottom: 0.5rem;">🎯 Part 1 Specific Tips</h4>
                        <ul style="color: #666; font-size: 0.9rem; line-height: 1.5; padding-left: 1rem;">
                            <li>Answer in 2-3 sentences (20-30 seconds)</li>
                            <li>Be personal and give specific details</li>
                            <li>Use present simple for current situations</li>
                            <li>Add reasons: "because...", "since..."</li>
                            <li>Show enthusiasm about topics you enjoy</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Global variables for audio recording
        let mediaRecorder;
        let audioChunks = [];
        let originalAudioBlob = null;
        let isRecording = false;
        let recordingTimer;
        let recordingSeconds = 0;
        let audioContext;
        let analyser;
        let microphone;
        let dataArray;
        let animationFrameId;

        // Global variables for question audio playback
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        let isPlayingQuestion = false;
        let currentQuestionIndex = 0;
        let autoPlayActive = false;

        // Question texts for audio playback
        const questions = [
            "What do you like to do in your free time?",
            "Do you have any hobbies?",
            "What hobbies are popular in your country?",
            "How did you become interested in your hobby?",
            "Do you think hobbies are important?",
            "How much time do you spend on your hobbies?"
        ];

        // IELTS Part 1 Hobbies & Interests - Ideal Response Patterns
        const idealResponsePatterns = {
            1: { // What do you like to do in your free time?
                keyElements: ["specific activities", "frequency", "personal enjoyment"],
                sampleResponse: "In my free time, I really enjoy reading books, especially mystery novels. I try to read for at least an hour every evening because it helps me relax and escape from daily stress. I also like to go hiking on weekends when the weather is nice.",
                bandCriteria: {
                    fluency: "Natural flow with appropriate hesitation",
                    lexical: "Leisure vocabulary, frequency expressions",
                    grammar: "Present simple, time expressions, linking words",
                    pronunciation: "Clear leisure activity vocabulary"
                }
            },
            2: { // Do you have any hobbies?
                keyElements: ["specific hobbies", "duration", "personal interest"],
                sampleResponse: "Yes, I have several hobbies that I'm passionate about. My main hobby is photography - I've been doing it for about three years now. I love capturing nature scenes and street photography. I also enjoy cooking and trying new recipes on weekends.",
                bandCriteria: {
                    fluency: "Confident delivery with natural pausing",
                    lexical: "Hobby-specific vocabulary, time expressions",
                    grammar: "Present perfect, present simple, descriptive language",
                    pronunciation: "Clear hobby-related terms"
                }
            },
            3: { // What hobbies are popular in your country?
                keyElements: ["popular activities", "cultural context", "personal observation"],
                sampleResponse: "In my country, sports are extremely popular, particularly football and basketball. Many people also enjoy outdoor activities like hiking and cycling. Recently, I've noticed that photography and cooking have become more popular, especially among young people who share their experiences on social media.",
                bandCriteria: {
                    fluency: "Smooth delivery with cultural awareness",
                    lexical: "Sports vocabulary, trend language, descriptive adjectives",
                    grammar: "Present simple, present perfect, comparative structures",
                    pronunciation: "Clear cultural and activity vocabulary"
                }
            },
            4: { // How did you become interested in your hobby?
                keyElements: ["origin story", "timeline", "influence factors"],
                sampleResponse: "I became interested in photography when I was in university. My roommate had a camera and taught me the basics. Initially, I just took random pictures, but gradually I learned about composition and lighting. What really hooked me was seeing how I could capture beautiful moments and tell stories through images.",
                bandCriteria: {
                    fluency: "Narrative flow with clear progression",
                    lexical: "Past time expressions, learning vocabulary, emotional language",
                    grammar: "Past tenses, time connectors, when/while clauses",
                    pronunciation: "Clear storytelling with appropriate stress"
                }
            },
            5: { // Do you think hobbies are important?
                keyElements: ["personal opinion", "benefits", "reasoning"],
                sampleResponse: "Absolutely, I think hobbies are very important for several reasons. They provide a great way to relax and reduce stress after work or study. Hobbies also help people develop new skills and meet like-minded individuals. Personally, my hobbies have taught me patience and creativity, which have benefited me in other areas of life.",
                bandCriteria: {
                    fluency: "Opinion-giving with clear structure",
                    lexical: "Opinion vocabulary, benefit language, personal qualities",
                    grammar: "Opinion expressions, present simple, linking words",
                    pronunciation: "Clear opinion and reasoning vocabulary"
                }
            },
            6: { // How much time do you spend on your hobbies?
                keyElements: ["time allocation", "frequency", "scheduling"],
                sampleResponse: "I try to dedicate time to my hobbies regularly, though it depends on my schedule. During weekdays, I usually spend about an hour in the evening on my hobbies, mainly reading or practicing photography editing. On weekends, I can spend several hours, especially if I go out for photo shoots or cooking sessions.",
                bandCriteria: {
                    fluency: "Time-related expressions with natural delivery",
                    lexical: "Time vocabulary, frequency expressions, activity-specific terms",
                    grammar: "Time expressions, present simple, conditional structures",
                    pronunciation: "Clear time and frequency vocabulary"
                }
            }
        };

        // Analysis variables
        let currentQuestionBeingAnswered = 1;
        let analysisResult = null;

        // Initialize audio visualizer
        function initializeVisualizer() {
            const visualizerBars = document.getElementById('visualizerBars');
            for (let i = 0; i < 30; i++) {
                const bar = document.createElement('div');
                bar.className = 'visualizer-bar';
                bar.style.height = '5px';
                visualizerBars.appendChild(bar);
            }
        }

        // Update visualizer during recording
        function updateVisualizer() {
            if (!analyser || !isRecording) return;
            
            analyser.getByteFrequencyData(dataArray);
            const bars = document.querySelectorAll('.visualizer-bar');
            
            for (let i = 0; i < bars.length; i++) {
                const barHeight = (dataArray[i] / 255) * 60 + 5;
                bars[i].style.height = `${barHeight}px`;
            }
            
            animationFrameId = requestAnimationFrame(updateVisualizer);
        }

        // Start recording function
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // Set up audio context for visualization
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                microphone.connect(analyser);
                
                analyser.fftSize = 256;
                const bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);
                
                // Set up media recorder
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = function(event) {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = function() {
                    originalAudioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    updateUI('recorded');
                };
                
                // Start recording
                mediaRecorder.start();
                isRecording = true;
                recordingSeconds = 0;
                
                // Start timer
                recordingTimer = setInterval(() => {
                    recordingSeconds++;
                    updateTimerDisplay();
                }, 1000);
                
                // Update UI and start visualization
                updateUI('recording');
                updateVisualizer();
                
            } catch (error) {
                console.error('Error starting recording:', error);
                alert('Could not access microphone. Please check your permissions and try again.');
            }
        }

        // Stop recording function
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                isRecording = false;
                clearInterval(recordingTimer);
                cancelAnimationFrame(animationFrameId);
                
                // Reset visualizer bars
                const bars = document.querySelectorAll('.visualizer-bar');
                bars.forEach(bar => bar.style.height = '5px');
            }
        }

        // Play original recording
        function playOriginal() {
            if (originalAudioBlob) {
                const audioUrl = URL.createObjectURL(originalAudioBlob);
                const audio = new Audio(audioUrl);
                audio.play();
                
                // Update status during playback
                updateRecordingStatus('Playing original recording...');
                audio.addEventListener('ended', () => {
                    updateRecordingStatus('Original recording finished');
                    setTimeout(() => updateRecordingStatus('Ready to record your next response'), 2000);
                });
            }
        }

        // Audio Processing with Speech-to-Text Analysis
        async function processAudio() {
            if (!originalAudioBlob) return;
            
            updateUI('processing');
            updateRecordingStatus('System is analyzing your response...');
            
            try {
                // Step 1: Convert speech to text
                updateRecordingStatus('Converting speech to text...');
                const transcript = await speechToText(originalAudioBlob);
                
                // Step 2: Analyze response against IELTS criteria
                updateRecordingStatus('Analyzing IELTS performance...');
                analysisResult = await analyzeIELTSResponse(transcript, currentQuestionBeingAnswered);
                
                // Step 3: Generate improved response
                updateRecordingStatus('Generating improved response...');
                const improvedText = generateImprovedResponse(transcript, analysisResult, currentQuestionBeingAnswered);
                

                
                // Step 5: Display analysis results
                displayAnalysisResults(transcript, analysisResult, improvedText);
                
                updateRecordingStatus('Analysis complete! Review the feedback below.');
                
                // Show analysis section
                document.getElementById('analysisSection').style.display = 'block';
                document.getElementById('analysisSection').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Processing Error:', error);
                updateRecordingStatus('Error during analysis. Please try again.');
                // Fallback to mock processing
                await mockProcessAudio();
            }
        }

        // Fallback mock processing
        async function mockProcessAudio() {
            await new Promise(resolve => setTimeout(resolve, 2000));
            updateRecordingStatus('Mock processing complete!');
        }

        async function speechToText(audioBlob) {
            // Simulate API processing time
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // PLACEHOLDER: In real implementation, this would call:
            // - Google Cloud Speech-to-Text
            // - Azure Cognitive Services Speech
            // - Amazon Transcribe
            // - Speech Recognition API
            
            // For demo, return mock transcripts based on selected question
            const mockTranscripts = {
                1: "I like to read books and watch movies in my free time.",
                2: "Yes, I enjoy photography and cooking.",
                3: "Sports and outdoor activities are very popular in my country.",
                4: "I started photography when my friend showed me how to use a camera.",
                5: "Yes, I think hobbies are important for relaxation and personal development.",
                6: "I spend about two hours on my hobbies during weekends."
            };
            
            return mockTranscripts[currentQuestionBeingAnswered] || "I enjoy spending time on various activities.";
        }

        // IELTS Response Analysis Engine
        async function analyzeIELTSResponse(transcript, questionNumber) {
            // Simulate analysis processing
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            const idealPattern = idealResponsePatterns[questionNumber];
            const analysis = {
                questionNumber: questionNumber,
                transcript: transcript,
                wordCount: transcript.split(' ').length,
                missingElements: [],
                strengths: [],
                improvements: [],
                bandScores: {
                    fluency: 0,
                    lexical: 0,
                    grammar: 0,
                    pronunciation: 0,
                    overall: 0
                }
            };

            // Analyze missing key elements
            idealPattern.keyElements.forEach(element => {
                if (!checkElementPresent(transcript, element, questionNumber)) {
                    analysis.missingElements.push(element);
                }
            });

            // Assess response quality
            analysis.strengths = assessStrengths(transcript, questionNumber);
            analysis.improvements = generateImprovements(transcript, analysis.missingElements, questionNumber);
            analysis.bandScores = calculateBandScores(transcript, analysis.missingElements, questionNumber);

            return analysis;
        }

        // Check if key elements are present in response
        function checkElementPresent(transcript, element, questionNumber) {
            const lowerTranscript = transcript.toLowerCase();
            
            switch(questionNumber) {
                case 1: // Free time activities
                    if (element === "specific activities") return lowerTranscript.includes("read") || lowerTranscript.includes("watch") || lowerTranscript.includes("play");
                    if (element === "frequency") return lowerTranscript.includes("usually") || lowerTranscript.includes("often") || lowerTranscript.includes("weekend");
                    if (element === "personal enjoyment") return lowerTranscript.includes("like") || lowerTranscript.includes("enjoy") || lowerTranscript.includes("love");
                    return true;
                case 2: // Hobbies
                    if (element === "specific hobbies") return lowerTranscript.includes("photography") || lowerTranscript.includes("cooking") || lowerTranscript.includes("sports");
                    if (element === "duration") return lowerTranscript.includes("year") || lowerTranscript.includes("month") || lowerTranscript.includes("long");
                    if (element === "personal interest") return lowerTranscript.includes("enjoy") || lowerTranscript.includes("passionate") || lowerTranscript.includes("love");
                    return true;
                case 3: // Popular hobbies
                    if (element === "popular activities") return lowerTranscript.includes("sport") || lowerTranscript.includes("popular") || lowerTranscript.includes("common");
                    if (element === "cultural context") return lowerTranscript.includes("country") || lowerTranscript.includes("people") || lowerTranscript.includes("culture");
                    return lowerTranscript.split(' ').length > 5;
                case 4: // How became interested
                    if (element === "origin story") return lowerTranscript.includes("started") || lowerTranscript.includes("began") || lowerTranscript.includes("first");
                    if (element === "timeline") return lowerTranscript.includes("when") || lowerTranscript.includes("ago") || lowerTranscript.includes("university");
                    return lowerTranscript.split(' ').length > 5;
                case 5: // Importance of hobbies
                    if (element === "personal opinion") return lowerTranscript.includes("think") || lowerTranscript.includes("believe") || lowerTranscript.includes("yes");
                    if (element === "benefits") return lowerTranscript.includes("important") || lowerTranscript.includes("help") || lowerTranscript.includes("good");
                    return lowerTranscript.split(' ').length > 4;
                case 6: // Time spent
                    if (element === "time allocation") return lowerTranscript.includes("hour") || lowerTranscript.includes("time") || lowerTranscript.includes("spend");
                    if (element === "frequency") return lowerTranscript.includes("weekend") || lowerTranscript.includes("daily") || lowerTranscript.includes("week");
                    return lowerTranscript.split(' ').length > 4;
                default:
                    return true;
            }
        }

        // Assess response strengths
        function assessStrengths(transcript, questionNumber) {
            const strengths = [];
            const wordCount = transcript.split(' ').length;
            
            if (wordCount >= 15) strengths.push("Good length - adequate detail provided");
            if (transcript.includes("because") || transcript.includes("since")) strengths.push("Good use of reasoning");
            if (transcript.includes("very") || transcript.includes("really")) strengths.push("Shows personal opinion");
            if (transcript.split('.').length > 1) strengths.push("Multiple sentences used");
            
            return strengths;
        }

        // Generate improvement suggestions
        function generateImprovements(transcript, missingElements, questionNumber) {
            const improvements = [];
            const idealPattern = idealResponsePatterns[questionNumber];
            
            missingElements.forEach(missing => {
                switch(missing) {
                    case "specific activities":
                        improvements.push("Mention specific activities you enjoy doing");
                        break;
                    case "frequency":
                        improvements.push("Add how often you do these activities");
                        break;
                    case "personal enjoyment":
                        improvements.push("Express your personal feelings about the activities");
                        break;
                    case "specific hobbies":
                        improvements.push("Name specific hobbies you have");
                        break;
                    case "duration":
                        improvements.push("Mention how long you've been doing this hobby");
                        break;
                    case "personal interest":
                        improvements.push("Explain why you find it interesting");
                        break;
                    case "popular activities":
                        improvements.push("Mention what activities are popular");
                        break;
                    case "cultural context":
                        improvements.push("Add context about your country or culture");
                        break;
                    case "origin story":
                        improvements.push("Explain how you started this hobby");
                        break;
                    case "timeline":
                        improvements.push("Mention when you began");
                        break;
                    case "personal opinion":
                        improvements.push("Give your clear opinion");
                        break;
                    case "benefits":
                        improvements.push("Explain the benefits or importance");
                        break;
                    case "time allocation":
                        improvements.push("Be specific about time spent");
                        break;
                    case "scheduling":
                        improvements.push("Mention when you do your hobbies");
                        break;
                }
            });
            
            if (transcript.split(' ').length < 15) {
                improvements.push("Extend your answer - aim for 20-30 seconds (2-3 sentences)");
            }
            
            if (!transcript.includes("because") && !transcript.includes("since")) {
                improvements.push("Add reasons using 'because' or 'since' to explain your answers");
            }
            
            return improvements;
        }

        // Calculate band scores
        function calculateBandScores(transcript, missingElements, questionNumber) {
            const wordCount = transcript.split(' ').length;
            const sentences = transcript.split(/[.!?]+/).filter(s => s.trim().length > 0).length;
            
            // Base scores
            let fluency = 6.0;
            let lexical = 6.0;
            let grammar = 6.0;
            let pronunciation = 6.5; // Assumed good for written analysis
            
            // Adjust based on length
            if (wordCount >= 25) fluency += 0.5;
            if (wordCount >= 35) fluency += 0.5;
            if (wordCount < 10) fluency -= 1.0;
            
            // Adjust based on missing elements
            const missedCount = missingElements.length;
            if (missedCount === 0) {
                lexical += 0.5;
                fluency += 0.5;
            } else if (missedCount >= 2) {
                lexical -= 0.5;
                fluency -= 0.5;
            }
            
            // Adjust based on complexity
            if (transcript.includes("because") || transcript.includes("since")) {
                grammar += 0.5;
                fluency += 0.3;
            }
            
            if (sentences >= 3) {
                fluency += 0.3;
                grammar += 0.2;
            }
            
            // Cap scores at 9.0
            fluency = Math.min(9.0, Math.max(4.0, fluency));
            lexical = Math.min(9.0, Math.max(4.0, lexical));
            grammar = Math.min(9.0, Math.max(4.0, grammar));
            pronunciation = Math.min(9.0, Math.max(4.0, pronunciation));
            
            const overall = (fluency + lexical + grammar + pronunciation) / 4;
            
            return {
                fluency: Math.round(fluency * 2) / 2,
                lexical: Math.round(lexical * 2) / 2,
                grammar: Math.round(grammar * 2) / 2,
                pronunciation: Math.round(pronunciation * 2) / 2,
                overall: Math.round(overall * 2) / 2
            };
        }

        // Generate improved response
        function generateImprovedResponse(originalTranscript, analysis, questionNumber) {
            const patterns = {
                1: "In my free time, I really enjoy [specific activities]. I usually [frequency] because [reason]. I find these activities [personal feelings] and they help me [benefit].",
                2: "Yes, I have several hobbies that I'm passionate about. My main hobby is [specific hobby] - I've been doing it for [duration]. I particularly enjoy [aspect] because [reason].",
                3: "In my country, [popular activities] are extremely popular. Many people enjoy [examples] especially [demographic]. I've noticed that [trend] has become more common recently.",
                4: "I became interested in [hobby] when [timeline/situation]. Initially, [beginning], but gradually [development]. What really attracted me was [key factor].",
                5: "Absolutely, I think hobbies are very important because [benefit 1] and [benefit 2]. Personally, my hobbies have [personal impact] which has helped me [specific benefit].",
                6: "I try to dedicate [time amount] to my hobbies regularly. During [frequency], I usually [activity], and on [other time] I can [extended activity]. It depends on [factor]."
            };
            
            return patterns[questionNumber] || "I would extend this answer with more specific details, examples, and personal reasons to make it more comprehensive and engaging.";
        }

        // Display analysis results
        function displayAnalysisResults(transcript, analysis, improvedText) {
            // Display transcript
            document.getElementById('transcriptResult').textContent = transcript;
            
            // Display analysis
            let analysisHTML = `
                <div style="margin-bottom: 1rem;">
                    <strong>Response Length:</strong> ${analysis.wordCount} words<br>
                    <strong>Elements Covered:</strong> ${analysis.strengths.length > 0 ? analysis.strengths.join(', ') : 'Basic response provided'}
                </div>
            `;
            
            if (analysis.missingElements.length > 0) {
                analysisHTML += `
                    <div style="margin-bottom: 1rem;">
                        <strong style="color: #dc3545;">Missing Elements:</strong>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                            ${analysis.missingElements.map(element => `<li>${element}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            if (analysis.improvements.length > 0) {
                analysisHTML += `
                    <div>
                        <strong style="color: #007bff;">Suggestions for Improvement:</strong>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                            ${analysis.improvements.map(improvement => `<li>${improvement}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            document.getElementById('analysisResult').innerHTML = analysisHTML;
            
            // Display improved response
            document.getElementById('improvedResponse').textContent = improvedText;
            
            // Display band scores
            const currentScores = analysis.bandScores;
            const improvedScores = {
                fluency: Math.min(9.0, currentScores.fluency + 0.5),
                lexical: Math.min(9.0, currentScores.lexical + 0.5),
                grammar: Math.min(9.0, currentScores.grammar + 0.5),
                pronunciation: currentScores.pronunciation,
                overall: 0
            };
            improvedScores.overall = (improvedScores.fluency + improvedScores.lexical + improvedScores.grammar + improvedScores.pronunciation) / 4;
            
            document.getElementById('currentBandScore').innerHTML = `
                <div>Overall: ${currentScores.overall}</div>
                <small>Fluency: ${currentScores.fluency} | Lexical: ${currentScores.lexical} | Grammar: ${currentScores.grammar} | Pronunciation: ${currentScores.pronunciation}</small>
            `;

            document.getElementById('improvedBandScore').innerHTML = `
                <div>Overall: ${improvedScores.overall}</div>
                <small>Fluency: ${improvedScores.fluency} | Lexical: ${improvedScores.lexical} | Grammar: ${improvedScores.grammar} | Pronunciation: ${improvedScores.pronunciation}</small>
            `;
        }

        // Update current question for analysis
        function updateCurrentQuestion() {
            currentQuestionBeingAnswered = parseInt(document.getElementById('questionSelect').value);
            console.log('Selected question:', currentQuestionBeingAnswered);
        }

        // Fallback mock processing
        async function mockProcessAudio() {
            await new Promise(resolve => setTimeout(resolve, 2000));

            updateRecordingStatus('Mock processing complete!');
        }



        // Update UI based on current state
        function updateUI(state) {
            const recordBtn = document.getElementById('recordBtn');
            const stopBtn = document.getElementById('stopBtn');
            const playBtn = document.getElementById('playBtn');
            const processBtn = document.getElementById('processBtn');
            
            // Reset all buttons
            recordBtn.disabled = false;
            stopBtn.disabled = true;
            playBtn.disabled = true;
            processBtn.disabled = true;
            
            switch(state) {
                case 'recording':
                    recordBtn.disabled = true;
                    stopBtn.disabled = false;
                    updateRecordingStatus('Recording... Speak clearly into your microphone');
                    break;
                case 'recorded':
                    playBtn.disabled = false;
                    processBtn.disabled = false;
                    updateRecordingStatus('Recording complete! You can play it back or submit for analysis');
                    break;
                case 'processing':
                    recordBtn.disabled = true;
                    playBtn.disabled = true;
                    processBtn.disabled = true;
                    updateRecordingStatus('System is analyzing and improving your recording...');
                    break;
                case 'idle':
                default:
                    updateRecordingStatus('Ready to record your response');
                    break;
            }
        }

        // Update recording status display
        function updateRecordingStatus(message) {
            const statusElement = document.getElementById('recordingStatus');
            statusElement.textContent = message;
            
            // Update status styling based on content
            statusElement.className = 'recording-status';
            if (message.includes('Recording')) {
                statusElement.classList.add('recording');
            } else if (message.includes('complete') || message.includes('finished') || message.includes('ready')) {
                statusElement.classList.add('recorded');
            } else if (message.includes('Processing') || message.includes('analyzing')) {
                statusElement.classList.add('processing');
            } else {
                statusElement.classList.add('idle');
            }
        }

        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(recordingSeconds / 60);
            const seconds = recordingSeconds % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = timeString;
        }

        // Menu toggle functionality (from GA_TEMPLATE)
        function toggleMenu() {
            const menu = document.getElementById('slideMenu');
            const container = document.getElementById('container');
            const toggleBtn = document.getElementById('menuToggle');
            const toggleLabel = document.getElementById('menuToggleLabel');
            
            if (menu.classList.contains('collapsed')) {
                menu.classList.remove('collapsed');
                toggleBtn.classList.remove('collapsed');
                toggleLabel.classList.remove('collapsed');
                container.classList.remove('menu-collapsed');
                toggleBtn.innerHTML = '›';
                toggleLabel.textContent = 'Collapse';
            } else {
                menu.classList.add('collapsed');
                toggleBtn.classList.add('collapsed');
                toggleLabel.classList.add('collapsed');
                container.classList.add('menu-collapsed');
                toggleBtn.innerHTML = '‹';
                toggleLabel.textContent = 'Expand';
            }
        }

        // Navigation Functions for Analysis Results
        function goToNextQuestion() {
            // Get current question number
            const currentQuestion = parseInt(document.getElementById('questionSelect').value);
            
            // Calculate next question (cycle back to 1 if we're at question 6)
            const nextQuestion = currentQuestion >= 6 ? 1 : currentQuestion + 1;
            
            // Store the next question in URL parameters and reload
            const url = new URL(window.location);
            url.searchParams.set('question', nextQuestion);
            window.location.href = url.toString();
        }

        function refreshCurrentQuestion() {
            // Get current question number
            const currentQuestion = parseInt(document.getElementById('questionSelect').value);
            
            // Store the current question in URL parameters and reload
            const url = new URL(window.location);
            url.searchParams.set('question', currentQuestion);
            window.location.href = url.toString();
        }

        // Function to set question from URL parameters on page load
        function setQuestionFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const questionParam = urlParams.get('question');
            
            if (questionParam) {
                const questionNumber = parseInt(questionParam);
                if (questionNumber >= 1 && questionNumber <= 6) {
                    document.getElementById('questionSelect').value = questionNumber;
                    currentQuestionBeingAnswered = questionNumber;
                    console.log('🎯 Set question from URL:', questionNumber);
                    
                    // Scroll to the recording section after setting the question
                    setTimeout(() => {
                        const recordingSection = document.querySelector('.recording-panel');
                        if (recordingSection) {
                            recordingSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 500);
                    
                }
            }
        }

        // Slide-out Menu Navigation Functions
        function scrollToSection(sectionId) {
            let targetElement;
            
            switch(sectionId) {
                case 'instructions':
                    targetElement = document.getElementById('instructions-section');
                    break;
                case 'recording':
                    targetElement = document.getElementById('recording-section');
                    break;
                case 'analysis':
                    targetElement = document.getElementById('analysisSection');
                    break;
                case 'guidance':
                    targetElement = document.getElementById('guidance-section');
                    break;
                default:
                    console.log('Section not found:', sectionId);
                    return;
            }
            
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                updateActiveMenuItem(sectionId);
            }
        }

        function updateActiveMenuItem(activeSection) {
            // Remove active class from all menu items
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => item.classList.remove('active'));
            
            // Add active class to the current section's menu item
            const sectionMap = {
                'instructions': '📋 Instructions',
                'recording': '🎙️ Recording Studio',
                'analysis': '📊 Analysis Results',
                'guidance': '🎯 Band Score Guidance'
            };
            
            if (sectionMap[activeSection]) {
                const activeItem = Array.from(menuItems).find(item => 
                    item.textContent.includes(sectionMap[activeSection])
                );
                if (activeItem) {
                    activeItem.classList.add('active');
                }
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎤 IELTS Speaking Part 1 - Hobbies & Interests page loaded');
            initializeVisualizer();
            
            // Set question from URL if provided
            setQuestionFromURL();
            
            // Set initial UI state
            updateUI('idle');
            
            // Check for audio support
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                updateRecordingStatus('Audio recording not supported in this browser');
                document.getElementById('recordBtn').disabled = true;
            }
        });

        // Back button functionality
        function handleBackButton() {
            console.log('🔄 Back button clicked from IELTS Speaking Part 1 - Going to Speaking Introduction');
            window.location.href = 'IELTS_General_Speaking_Introduction.html';
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (isRecording) {
                stopRecording();
            }
        });
    </script>
</body>
</html> 